# 비트코인 자동매매 모델 구축 설명서 (개선안)

## 📌 1. 개발 목표
- 월 5% 이상 수익률 달성
- 고급 리스크 관리 및 자본 손실 최소화
- Python 기반 MVP 개발


## 📌 2. 시스템 아키텍처 및 모듈 구성

### 핵심 모듈
- **메인모듈**: 시스템 통합 제어
- **백테스트모듈**: 전략 성능 평가
- **데이터관리모듈**: 시장 데이터 및 뉴스 분석 관리
- **모델관리모듈**: 예측 모델(LSTM, 랜덤포레스트, 강화학습, GPT) 관리
- **투자전략모듈**: 매매 전략 및 신호 생성
- **리스크관리모듈**: 강화학습 기반 동적 리스크 관리
- **로깅모니터링모듈**: 시스템 상태 추적
- **설정관리모듈**: 파라미터 중앙 관리

## 📌 3. 주요 개선사항

### ✅ 리스크 관리 강화 (강화학습 기반)
- 강화학습으로 손절·익절 비율과 포지션 크기 동적 할당
- 시장 변동성 지표(ATR, VIX) 기반으로 손절폭 실시간 조정

### ✅ 시장 상황별 차별화 전략
- **상승장**: 포지션 최대 30%, 손절폭 -10%
- **횡보장**: 포지션 최대 20%, 손절폭 -7%
- **하락장**: 포지션 최대 15%, 손절폭 -5%
- 기술적 지표 (EMA, MACD, ADX)로 시장상황 판별

### ✅ 실시간 급변 감지
- 볼린저 밴드 돌파(1.5σ), 거래량(Z-score>3), RSI 급변(25/75) 조건 발생 시 즉시 대응

### ✅ 예외처리 기본 전략
- API 오류 발생 시 최대 3회 재시도 후 다음 거래 주기로 연기
- 네트워크 및 자금 문제 발생 시 안전 종료 및 상태 저장

## 📌 4. GPT 활용방안

### GPT 호출 조건
- 시장 급변 상황(볼린저밴드 돌파, RSI 급변, 거래량 급증)

### GPT 호출 시 입력 데이터
- 최근 24시간 시장 현황, 기술적 지표(RSI, 볼린저 밴드, 거래량 Z-score)
- 공포&탐욕 지수
- 보유 포지션 상태

### GPT 출력 형식
- 상황별 별도 포맷 (시장분석, 대응 전략, 신뢰도, 반성 최소의견 포함)

### GPT 신뢰도 기준
- 80% 이상 즉시 적용, 60~79% 강화학습과 자체 전략 결합, 60% 이하 자체 전략 우선

### GPT 선택적사용
- 실제매매에서는 GPT API호출이 필요하지만(use_gpt = true), 백테스트환경에서는 호출X(use_gpt = false)
- 이와마찬가지로 실제 매매에서 gpu 사용, 백테스트에서는 gpu사용x (똑같이 true/false)

## 📌 5. 데이터 관리

### 거래소 안내
- 업비트 거래소를 이용하여 원시데이터 추출 및 실제 거래 실행(pyupbit)

### 데이터 추가 가이드
- 업비트로부터 1000일 일봉데이터(추가요청), 시간봉데이터 최대 요청함.
- 만약 일봉데이터가 1000개보다 적다면 데이터 노이즈 로직을 이용해 1000일로 변환
- 시간봉데이터는 2000개의 데이터를 한세트로 규정. 2000개의 데이터가 쌓일때까지 스택. 2000개의 데이터 수집후에는 다음 파일에서 2000시간 추가 스택.
- 이 모든 데이터수집은 당일 첫 백테스팅실행시 진행.

### 데이터 노이즈 추가
- 원본 데이터 평균·표준편차 유지한 정규분포 기반 ±1~2% 범위 내 노이즈 추가

### 뉴스 데이터 처리
- 미국 동부시간(EST) 오전 9시 하루 1회 뉴스 데이터 수집 및 감정 분석 업데이트

## 📌 6. 백테스트 전략

### 백테스트 데이터 분할
- 훈련: 650일, 검증: 150일, 테스트: 200일
### 백테스트 환경설정
- 초기자금: 1000만원, 하루매매주기 6회

### 강화학습 적용
- 백테스트 단계에선 사전 정의된 고정 정책 사용
- 실제 운영 단계에서만 온라인 학습 적용
- 매회 백테스트 독립적 수행 (초기화 철저)

## 📌 7. 성능 평가 지표
- 샤프 비율, 소티노 비율, Win Rate, 평균 손익비, 최대 낙폭(MDD), 추적 오차

## 📌 8. 프롬프트 설계 (GPT 호출)
```
[비트코인 시장 긴급 분석 요청]

# 시장 현황:
- 최근 24시간 가격 변화:
- 현재 시장 상태:

# 주요 기술적 지표:
- 볼린저밴드 상태:
- RSI 지수:
- 거래량(Z-score):

# 공포&탐욕 지수:
- 현재값:

# 현재 포지션 상태:
- 보유 비율:
- 현재 손익:

# 판단 요청 이유:

[요청사항]
1. 현 상황 분석:
2. 대응 전략 추천:
3. 신뢰도(%):
4. 반성을 위한 최소 의견 (과거 유사사례, 판단 근거 등 필수 제공):


```
## 📌 9. 모델재훈련
-신뢰도 기반 모델 재훈련 전략:
        트리거 메커니즘:
            기본 임계값: 신뢰도 70% 이하
            연속 트리거: 3-5회 연속으로 낮은 신뢰도 발생 시 (일시적 이상치 방지)
            이동평균 트리거: 최근 10-20회 평균 신뢰도가 기준 이하로 하락 시
        
        단계적 대응:
            1단계: 신뢰도 70-65% - 추가 데이터로 부분 미세조정(fine-tuning)
            2단계: 신뢰도 65-60% - 하이퍼파라미터 조정 및 전체 모델 재훈련
            3단계: 신뢰도 60% 이하 - 모델 아키텍처 재검토 및 대체 모델 활성화

## 📌 10. 각종 파라미터관리.
- 초기 mvp모델에서는 고정된 파라미터 사용.
- 추후 디벨롭과정에서 각종 파라미터최적값을 찾는 스크립트를 이용하여 적용.



